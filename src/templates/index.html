<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SecureBank - Fraud Detection System</title>
    <link rel="stylesheet" href="../static/css/style.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <i class="fas fa-shield-alt"></i>
                <span>SecureBank</span>
            </div>
            <div class="nav-links">
                <a href="#dashboard" class="nav-link active">Dashboard</a>
                <a href="#transactions" class="nav-link">Transactions</a>
                <a href="#security" class="nav-link">Security</a>
            </div>
        </div>
    </nav>

    <!-- Main Container -->
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="account-card">
                <div class="account-header">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="account-info">
                        <h3>John Doe</h3>
                        <p>Account: •••• 4832</p>
                    </div>
                </div>
                <div class="balance-section">
                    <div class="balance-amount">
                        <span class="balance-label">Available Balance</span>
                        <span class="balance-value" id="current-balance">$10,000.00</span>
                    </div>
                </div>
            </div>

            <div class="quick-stats">
                <div class="stat-item">
                    <div class="stat-icon success">
                        <i class="fas fa-check-circle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="success-tx">0</span>
                        <span class="stat-label">Approved</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon warning">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="flagged-tx">0</span>
                        <span class="stat-label">Flagged</span>
                    </div>
                </div>
                <div class="stat-item">
                    <div class="stat-icon danger">
                        <i class="fas fa-times-circle"></i>
                    </div>
                    <div class="stat-info">
                        <span class="stat-value" id="blocked-tx">0</span>
                        <span class="stat-label">Blocked</span>
                    </div>
                </div>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard Section -->
            <section id="dashboard" class="content-section active">
                <div class="section-header">
                    <h1>Transaction Dashboard</h1>
                    <p>Make secure payments with real-time fraud detection</p>
                </div>

                <!-- Transaction Form -->
                <div class="transaction-card">
                    <h2>New Transaction</h2>
                    <form id="transaction-form" class="transaction-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="amount">
                                    <i class="fas fa-dollar-sign"></i>
                                    Amount ($)
                                </label>
                                <input type="number" id="amount" step="0.01" min="0.01" required placeholder="0.00">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="merchant">
                                    <i class="fas fa-store"></i>
                                    Merchant
                                </label>
                                <select id="merchant" required>
                                    <option value="">Select Merchant</option>
                                    <option value="Amazon">Amazon</option>
                                    <option value="Flipkart">Flipkart</option>
                                    <option value="Myntra">Myntra</option>
                                    <option value="Swiggy">Swiggy</option>
                                    <option value="Zomato">Zomato</option>
                                    <option value="Ola">Ola</option>
                                    <option value="Uber">Uber</option>
                                    <option value="Paytm">Paytm</option>
                                    <option value="BookMyShow">BookMyShow</option>
                                    <option value="BigBasket">BigBasket</option>
                                    <option value="Dominos">Dominos</option>
                                    <option value="IRCTC">IRCTC</option>
                                    <option value="other">Other</option>
                                </select>
                                <input type="text" id="merchant-other" class="hidden" placeholder="Specify merchant name">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="merchant-category">
                                    <i class="fas fa-tags"></i>
                                    Category
                                </label>
                                <select id="merchant-category" required>
                                    <option value="">Select Category</option>
                                    <option value="E-commerce">E-commerce</option>
                                    <option value="Food Delivery">Food Delivery</option>
                                    <option value="Transport Services">Transport Services</option>
                                    <option value="Digital Payments">Digital Payments</option>
                                    <option value="Entertainment">Entertainment</option>
                                    <option value="General Retail">General Retail</option>
                                    <option value="Fashion & Apparel">Fashion & Apparel</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="location">
                                    <i class="fas fa-map-marker-alt"></i>
                                    Location
                                </label>
                                <select id="location" required>
                                    <option value="">Select Location</option>
                                    <option value="Mumbai">Mumbai</option>
                                    <option value="Delhi">Delhi</option>
                                    <option value="Chennai">Chennai</option>
                                    <option value="Bangalore">Bangalore</option>
                                    <option value="Hyderabad">Hyderabad</option>
                                    <option value="Pune">Pune</option>
                                    <option value="Ahmedabad">Ahmedabad</option>
                                    <option value="Kolkata">Kolkata</option>
                                    <option value="Indore">Indore</option>
                                    <option value="Nagpur">Nagpur</option>
                                    <option value="Nashik">Nashik</option>
                                    <option value="other">Other</option>
                                </select>
                                <input type="text" id="location-other" class="hidden" placeholder="Specify location">
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="payment-channel">
                                    <i class="fas fa-credit-card"></i>
                                    Payment Method
                                </label>
                                <select id="payment-channel" required>
                                    <option value="">Select Payment Method</option>
                                    <option value="Credit Card">Credit Card</option>
                                    <option value="Debit Card">Debit Card</option>
                                    <option value="UPI">UPI</option>
                                    <option value="Net Banking">Net Banking</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="device-used">
                                    <i class="fas fa-mobile-alt"></i>
                                    Device Used
                                </label>
                                <select id="device-used" required>
                                    <option value="">Select Device</option>
                                    <option value="Mobile">Mobile</option>
                                    <option value="Desktop">Desktop</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="submit" class="btn-primary">
                                <i class="fas fa-paper-plane"></i>
                                Process Transaction
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Recent Transactions -->
                <div class="recent-transactions">
                    <h2>Recent Transactions</h2>
                    <div class="transactions-list" id="transactions-list">
                        <div class="empty-state">
                            <i class="fas fa-receipt"></i>
                            <p>No transactions yet</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Transactions History Section -->
            <section id="transactions" class="content-section">
                <div class="section-header">
                    <h1>Transaction History</h1>
                    <p>Complete history of all your transactions</p>
                </div>
                <div class="transactions-table-container">
                    <table class="transactions-table" id="full-transactions-table">
                        <thead>
                            <tr>
                                <th>Date & Time</th>
                                <th>Merchant</th>
                                <th>Amount</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Fraud Score</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td colspan="6" class="empty-table">No transactions found</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Security Section -->
            <section id="security" class="content-section">
                <div class="section-header">
                    <h1>Security Center</h1>
                    <p>Monitor and manage your account security</p>
                </div>
                <div class="security-grid">
                    <div class="security-card">
                        <div class="security-icon">
                            <i class="fas fa-shield-alt"></i>
                        </div>
                        <h3>Fraud Detection Status</h3>
                        <p>AI-powered fraud detection is <span class="status-active">ACTIVE</span></p>
                        <div class="security-metrics">
                            <div class="metric">
                                <span class="metric-value" id="total-analyzed">0</span>
                                <span class="metric-label">Transactions Analyzed</span>
                            </div>
                            <div class="metric">
                                <span class="metric-value" id="fraud-detected">0</span>
                                <span class="metric-label">Fraud Attempts Blocked</span>
                            </div>
                        </div>
                    </div>
                    <div class="security-card">
                        <div class="security-icon">
                            <i class="fas fa-bell"></i>
                        </div>
                        <h3>Alerts & Notifications</h3>
                        <p>Real-time alerts for suspicious activity</p>
                        <div class="alert-settings">
                            <label class="toggle">
                                <input type="checkbox" id="email-alerts" checked>
                                <span class="toggle-slider"></span>
                                <span>Email Alerts</span>
                            </label>
                            <label class="toggle">
                                <input type="checkbox" id="sms-alerts" checked>
                                <span class="toggle-slider"></span>
                                <span>SMS Alerts</span>
                            </label>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Fraud Alert Modal -->
    <div id="fraud-alert-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header danger">
                <i class="fas fa-exclamation-triangle"></i>
                <h2>Potential Fraud Detected!</h2>
            </div>
            <div class="modal-body">
                <div class="fraud-details">
                    <div class="fraud-metric">
                        <span class="fraud-score" id="fraud-score">85%</span>
                        <span class="fraud-label">Fraud Probability</span>
                    </div>
                    <div class="transaction-details">
                        <h4>Transaction Details:</h4>
                        <div class="detail-item">
                            <span>Amount:</span>
                            <span id="alert-amount">$0.00</span>
                        </div>
                        <div class="detail-item">
                            <span>Merchant:</span>
                            <span id="alert-merchant">Unknown</span>
                        </div>
                        <div class="detail-item">
                            <span>Location:</span>
                            <span id="alert-location">Unknown</span>
                        </div>
                        <div class="detail-item">
                            <span>Time:</span>
                            <span id="alert-time">Just now</span>
                        </div>
                    </div>
                    <div class="fraud-reason">
                        <h4>Why this was flagged:</h4>
                        <ul id="fraud-reasons">
                            <li>Unusual transaction amount</li>
                            <li>Suspicious merchant pattern</li>
                            <li>Geographic inconsistency</li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="modal-actions">
                <button id="approve-transaction" class="btn-warning">
                    <i class="fas fa-check"></i>
                    Approve Anyway
                </button>
                <button id="cancel-transaction" class="btn-secondary">
                    <i class="fas fa-times"></i>
                    Cancel Transaction
                </button>
            </div>
        </div>
    </div>

    <!-- Loading Spinner -->
    <div id="loading-spinner" class="loading-spinner hidden">
        <div class="spinner"></div>
        <p>Processing transaction...</p>
    </div>

    <!-- Success Notification -->
    <div id="success-notification" class="notification success hidden">
        <i class="fas fa-check-circle"></i>
        <span id="success-message">Transaction completed successfully!</span>
    </div>

    <!-- Error Notification -->
    <div id="error-notification" class="notification error hidden">
        <i class="fas fa-exclamation-circle"></i>
        <span id="error-message">Transaction failed!</span>
    </div>

    <script src="../static/js/app.js"></script>
    <script src="../static/js/transaction.js"></script>
    <script src="../static/js/ui.js"></script>

<script>
// Debugging: Check if API is accessible
fetch('http://localhost:5000/api/health')
    .then(response => {
        console.log('API Health Status:', response.status);
        return response.json();
    })
    .then(data => console.log('API Health Data:', data))
    .catch(error => console.error('API Health Check Failed:', error));

// Check all endpoints
const endpoints = ['/api/balance', '/api/transactions', '/api/stats'];
endpoints.forEach(endpoint => {
    fetch('http://localhost:5000' + endpoint)
        .then(response => {
            console.log(`${endpoint} Status:`, response.status);
            return response.json();
        })
        .then(data => console.log(`${endpoint} Data:`, data))
        .catch(error => console.error(`${endpoint} Failed:`, error));
});
</script>

<script>
// Debug: Check why fraud modal might be showing
document.addEventListener('DOMContentLoaded', function() {
    console.log('=== DEBUG: Checking fraud modal state ===');
    const fraudModal = document.getElementById('fraud-alert-modal');
    console.log('Fraud modal element:', fraudModal);
    console.log('Fraud modal classes:', fraudModal?.className);
    console.log('Fraud modal display style:', fraudModal?.style.display);
    console.log('Fraud modal computed display:', window.getComputedStyle(fraudModal).display);
    
    // Force hide the modal on load
    if (fraudModal) {
        fraudModal.classList.add('hidden');
        fraudModal.style.display = 'none';
        console.log('Forced fraud modal to be hidden');
    }
    
    // Check if there are any pending transactions that might trigger the modal
    console.log('Current state:', window.app?.currentState);
    console.log('Pending transaction:', window.app?.currentState?.pendingTransaction);
});
</script>
</body>
</html>